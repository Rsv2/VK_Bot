Бот для VK. Описание от 11 июня 2020.
С тех пор ботом не пользовался и никаких изменений не вносил. Впрочем, бот до сих пор абсолютно рабочий, даже если сейчас код вам покажется чудовищным.

Описание.

Сразу оговорюсь, я очень далёк от сетевого общения и не перевариваю соц-сети как явление с самого их появления. Поэтому возможно я чего-то недопонимаю в том, как правильно должны работать боты. До этого задания я вообще не имел с ними дел, разве что, если ботами считать API, но с чатовыми не работал точно, как и аккаунта в VK не имел вплоть до этого задания. Извиняюсь за длинное описание.

Начало работы.
Перед запуском бота нужно заполнить форму на первой вкладке, все данные из неё будут храниться в файле Account.json в папке с исполняемым файлом. Первое получение индивидуального токена нужно сделать вручную, в дальнейшем он будет сразу подключаться и перескакивать на вторую вкладку. Я видел в вашем видео NuGet, который позволяет обойтись без браузера, но на тот момент с активацией было уже всё отлажено и я не стал с ним заморачиваться. Токен обновляется автоматически за час до окончания срока действия, но можно обновить и вручную.

Для добавления участника нужно ввести его ID (только число) и нажать «+», удаляется нажатием на «-», себя удалить невозможно. Файл Users.json храниться в папке с исполняемым.

Если нужно, я оставил окна отладки, просто сделайте их видимыми в XAML. Txt – постоянно показывает ответ сервера, AnswerTxt – просто подставляю где нужно в коде в целях отладки.

Несколько замечаний по поводу работы. Бот, кажется, работает стабильно, однако остались косяки уже со стороны VK (либо я ещё в чём-то у них не разобрался). В основном это касается прилагаемых файлов. В описании VK заявлено, что можно их загружать не более 10, по факту я ограничил загрузку 6-ю, а вообще рекомендую отправлять не более 3-х приложенных файлов за раз. С чем связано я не знаю, все файлы приходят по адресу в полном объёме, но в ответе сервера боту может оказаться половина, или вообще одна лишь картинка. То же самое в обратном направлении, от юзера к юзеру в VK приходит весь комплект, бот же может получить по LongPoll обрезанный вариант отправления. Кажется, более-менее, стабильно работает если отправлять не более 6-ти файлов. По одному, работает идеально.

Загрузка файлов Doc, ведёт себя самостоятельно и сама решает, какие файлы достойны загрузки на сервер, а какие нет. Какой-то логики в её выборе я не нашёл. Может из двух однотипных схожих файлов один загрузить, а другой на отрез отказаться. Впрочем, кажется "ест" большинство картинок, но текстовые и архивы - через один. Заявлено, что можно отправлять любые файлы, но на деле в лог приходят сообщения о неопознанных расширениях.

С музыкой всё понятно, может отказать в загрузке по копирайту. Видео в задании кажется не было, но без него вроде не комплект. Проигрывателем для медиа сделал WM Player, по-моему, он точно должен быть на любой Windows. Так-же можно скачивать аудио и видео по ПКМ. Выдрать потоковый url удалось лишь у видео, загруженных в группу. Для остальных, при клике на картинку, в буфер копируется стандартный адрес для VK плеера, который можно вставить в браузер и просмотреть уже там, скачать его уже естественно невозможно. Картинки просто выводятся в стандартном браузере и скачиваются обычным способом.

Знак скрепки, крайний справа, открывает окно файлов, приготовленных к отправке, где при желании можно удалить ненужные до отправления. Остальные иконки показывают тип загружаемых файлов. Честно говоря, не знаю, как лучше стоило сделать. В данном случае у меня файлы перед отправкой загружаются на сервер сразу после их выбора, а запрос на отправку сообщения работает с уже готовыми ссылками. То, что отображается в окне файлов к отправке уже загружено в VK, даже если в итоге их все удалить.

По Newtonsoft двоякое впечатление, конечно код отчасти сократился по сравнению с черновиком, где я для скорости просто выдирал нужные мне значения напрямую, однако в итоге у меня вышло чудовищное количество разных структур с кучей ненужных данных. Правда процесс их написания я автоматизировал, так что много времени на них не тратил.
